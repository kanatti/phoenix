# Iceberg Hands on

Trying out what iceberg can do.

Start:
```
docker-compose up -d
docker exec -it spark-iceberg pyspark-notebook
```

Stop:
```
docker-compose down
```

This gives:
- Notebook server on `localhost:8888`.
- Spark Driver UI on `localhost:8080`.

Compose spins up for containers:
1. spark-iceberg
2. iceberg-rest
3. minio
4. mc


## Inspecting artifacts

With volumes setup, artifacts generated by iceberg are available outside the docker for inspection.

1. `./minio-data` -> contains all minio data (actual parquet data files, manifests, manifest lists).
2. `./catalog` -> contains sqllite DB created by `iceberg-rest`.


### Sqlite Catalog

```sh
sqlite3 ./catalog/test.db
```


```
sqlite> .headers on
sqlite> .tables
iceberg_namespace_properties  iceberg_tables
sqlite> .mode box
sqlite> select * from iceberg_namespace_properties ;
┌──────────────┬───────────┬──────────────┬────────────────┐
│ catalog_name │ namespace │ property_key │ property_value │
├──────────────┼───────────┼──────────────┼────────────────┤
│ rest_backend │ nyc       │ owner        │ root           │
│ rest_backend │ nyc       │ exists       │ true           │
└──────────────┴───────────┴──────────────┴────────────────┘
sqlite> .mode line
sqlite> select * from iceberg_tables;
              catalog_name = rest_backend
           table_namespace = nyc
                table_name = taxis
         metadata_location = s3://warehouse/nyc/taxis/metadata/00002-874f754a-3ebc-4e10-9ec0-efd7827364ea.metadata.json
previous_metadata_location = s3://warehouse/nyc/taxis/metadata/00001-df14d0a0-5ec2-428f-955e-a84c899980bf.metadata.json
              iceberg_type = TABLE
```


### Minio files

```
❯ tree
.
└── nyc
    └── taxis
        ├── data
        │   └── 00001-2-0dbb995a-962a-41cd-8c7c-6147ca2d3254-0-00001.parquet
        │       ├── b9f9916c-bad8-4325-a55c-5f8cb05de0ad
        │       │   └── part.1
        │       └── xl.meta
        └── metadata
            ├── 00000-51a7f8b4-f33b-4abe-9ffd-ca4fd85b0d44.metadata.json
            │   └── xl.meta
            ├── 00001-df14d0a0-5ec2-428f-955e-a84c899980bf.metadata.json
            │   └── xl.meta
            ├── 00002-874f754a-3ebc-4e10-9ec0-efd7827364ea.metadata.json
            │   └── xl.meta
            ├── 0ce85d8e-7edb-411d-8b87-4975d819c1d1-m0.avro
            │   └── xl.meta
            └── snap-7542895044950486743-1-0ce85d8e-7edb-411d-8b87-4975d819c1d1.avro
                └── xl.meta
```

## References
- https://tabular.io/blog/docker-spark-and-iceberg-the-fastest-way-to-try-iceberg/